window.currentPart=function(){function t(t){for(this.cratesToPlace=0,this.levelMapOrig=new Array,this.levelHeight=t.length,i=0;i<this.levelHeight;i++)for(this.levelMapOrig[i]=new Array,this.levelWidth=t[i].length,j=0;j<this.levelWidth;j++)"@"==t[i].charAt(j)?this.levelMapOrig[i][j]=1:"o"==t[i].charAt(j)?this.levelMapOrig[i][j]=2:"x"==t[i].charAt(j)?(this.levelMapOrig[i][j]=3,this.cratesToPlace+=1):"^"==t[i].charAt(j)?(this.levelMapOrig[i][j]=4,this.playerStartX=j,this.playerStartY=i,this.playerStartDir=0):"v"==t[i].charAt(j)?(this.levelMapOrig[i][j]=4,this.playerStartX=j,this.playerStartY=i,this.playerStartDir=3):"<"==t[i].charAt(j)?(this.levelMapOrig[i][j]=4,this.playerStartX=j,this.playerStartY=i,this.playerStartDir=1):">"==t[i].charAt(j)?(this.levelMapOrig[i][j]=4,this.playerStartX=j,this.playerStartY=i,this.playerStartDir=2):this.levelMapOrig[i][j]=0}function e(){this.x=0,this.y=0,this.startX=0,this.startY=0,this.startDir=0,this.d=3,this.ani=0,this.animate=function(){this.ani++,this.ani>3&&(this.ani=0)},this.setStartPos=function(t,e,i){this.startX=t,this.startY=e,this.startDir=i},this.setPos=function(t,e,i){this.x=t,this.y=e,this.d=i},this.reset=function(){this.setPos(this.startX,this.startY,this.startDir)},this.moveUp=function(){w(X.Up)&&(this.y-=1,U+=1),this.d=X.Up,this.animate()},this.moveDown=function(){w(X.Down)&&(this.y+=1,U+=1),this.d=X.Down,this.animate()},this.moveLeft=function(){w(X.Left)&&(this.x-=1,U+=1),this.d=X.Left,this.animate()},this.moveRight=function(){w(X.Right)&&(this.x+=1,U+=1),this.d=X.Right,this.animate()}}function a(t,e,i,a,r,n,s){this.playerPrevX=t,this.playerPrevY=e,this.playerPrevDir=i,this.crateMoved=a,this.crateMoved&&(this.crateX=r,this.crateY=n,this.cratePushDir=s)}function r(t,e,i,r,n,s,o){T.length===B&&T.shift(),T.push(new a(t,e,i,r,n,s,o))}function n(){if(T.length>0){var t=T.pop();if(z.setPos(t.playerPrevX,t.playerPrevY,t.playerPrevDir),t.crateMoved)switch(t.cratePushDir){case X.Up:O[t.crateY][t.crateX]=Y.Empty,O[t.crateY+1][t.crateX]=Y.Crate;break;case X.Left:O[t.crateY][t.crateX]=Y.Empty,O[t.crateY][t.crateX+1]=Y.Crate;break;case X.Right:O[t.crateY][t.crateX]=Y.Empty,O[t.crateY][t.crateX-1]=Y.Crate;break;case X.Down:O[t.crateY][t.crateX]=Y.Empty,O[t.crateY-1][t.crateX]=Y.Crate}u()}else console.log("No more moves to undo!")}function s(t){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=32,this.canvas.height=32,this.ctx.drawImage(t,0,0,32,32)}function o(t,e,i,a,r){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=32,this.canvas.height=32,this.ctx.drawImage(t,e,i,a,r,0,0,32,32)}function h(){C=new Image,C.src="./parts/sokoban/assets/img/my_sprites_charset.png",C.onload=function(){for(P.drawImage(C,0,0),i=0;i<4;i++)for(W[i]=new Array,j=0;j<4;j++)W[i].push(new o(C,32*j,32*i,32,32));y()}}function c(t){L=t,h()}function l(t,e,i,a,r){for(yDif=-1;yDif<=1;yDif++)for(xDif=-1;xDif<=1;xDif++)if((0!==yDif||0!==xDif)&&(newX=e+xDif,newY=i+yDif,newX>=0&&newX<=a&&newY>=0&&newY<=r&&t[newY][newX]!=Y.Wall&&t[newY][newX]!=Y.None))return!1;return!0}function d(t){for(xMax=A[R].levelWidth-1,yMax=A[R].levelHeight-1,xMin=0,yMin=0,i=0;i<=yMax;i++)for(j=0;j<=xMax;j++)l(t,j,i,xMax,yMax)&&(t[i][j]=Y.None)}function y(){for(O=new Array,i=0;i<A[R].levelHeight;i++)for(O[i]=new Array,j=0;j<A[R].levelWidth;j++)switch(A[R].levelMapOrig[i][j]){case 1:O[i][j]=Y.Wall;break;case 2:O[i][j]=Y.Crate;break;case 3:O[i][j]=Y.Empty;break;case 4:O[i][j]=Y.Empty;break;default:O[i][j]=Y.Empty}z.setStartPos(A[R].playerStartX,A[R].playerStartY,A[R].playerStartDir),z.reset(),I=0,U=0,_=0,T.length=0,k(),d(O),u()}function g(){R<A.length-1&&(R+=1,f(),y(),u())}function f(){var t=document.getElementById("myDrawing"),e=t.getContext("2d");e.clearRect(0,0,t.width,t.height)}function p(){for(I=0,i=0;i<A[R].levelHeight;i++)for(j=0;j<A[R].levelWidth;j++)O[i][j]===Y.Crate&&A[R].levelMapOrig[i][j]===Y.Slot&&(I+=1);I===A[R].cratesToPlace&&(R+1<A.length?g():(console.log("VIDEO SUIVANTE"),window.next(),D.destroy()))}function u(){for(i=0;i<A[R].levelHeight;i++)for(j=0;j<A[R].levelWidth;j++)m(j,i);P.drawImage(W[playerDirOffset[z.d]][z.ani].canvas,z.x*H,z.y*N)}function v(){switch(z.d){case X.Up:m(z.x,z.y-1),m(z.x,z.y+1);break;case X.Left:m(z.x+1,z.y),m(z.x-1,z.y);break;case X.Right:m(z.x+1,z.y),m(z.x-1,z.y);break;case X.Down:m(z.x,z.y-1),m(z.x,z.y+1)}m(z.x,z.y),P.drawImage(W[playerDirOffset[z.d]][z.ani].canvas,z.x*H,z.y*N)}function m(t,e){switch(O[e][t]){case Y.None:b(t*H,e*N,H,N,"transparent");break;case Y.Wall:P.drawImage(L[Y.Wall].canvas,t*H,e*N);break;case Y.Crate:P.drawImage(L[Y.Crate].canvas,t*H,e*N);break;default:P.drawImage(L[Y.Empty].canvas,t*H,e*N),A[R].levelMapOrig[e][t]===Y.Slot&&(x(t*H+16,e*N+16,7,"#000000"),x(t*H+16,e*N+16,3,"#d2047b")),A[R].levelMapOrig[e][t]===Y.Start&&x(t*H+16,e*N+16,7,"transparent")}}function w(t){var e=0,i=0;switch(t){case X.Up:i=-1;break;case X.Left:e=-1;break;case X.Right:e=1;break;case X.Down:i=1}if(O[z.y+i][z.x+e]!=Y.Wall){if(O[z.y+i][z.x+e]!==Y.Crate)return r(z.x,z.y,z.d,!1,0,0,0),!0;if(O[z.y+2*i][z.x+2*e]===Y.Empty)return O[z.y+i][z.x+e]=Y.Empty,O[z.y+2*i][z.x+2*e]=Y.Crate,r(z.x,z.y,z.d,!0,z.x+2*e,z.y+2*i,t),_+=1,!0}return!1}function x(t,e,i,a){P.fillStyle=a,P.beginPath(),P.arc(t,e,i,0,2*Math.PI,!0),P.closePath(),P.fill()}function b(t,e,i,a,r){P.fillStyle=r,P.fillRect(t,e,i,a)}function k(){S.width=A[R].levelWidth*H,S.height=A[R].levelHeight*N}$(".sokoban audio").get(0).play();$("#sokoban").append('<div data-remodal-id="modal" ><h2>Sokoban</h2><p>Utilise les flÃªches ou appuie sur les boutons pour faire bouger les pierres !</p><div class="instruction-images"><img src="./parts/sokoban/assets/img/left-right-up-down.png" alt="left-right-up-down"/></div><button data-remodal-action="confirm" class="remodal-confirm">OK</button></div>   ');var D=$("[data-remodal-id=modal]").remodal();D.open();var A=new Array,M=new Array;M[0]="@@@@@@@@@@@@@@@@@",M[1]="@  @  @  @  @ x @",M[2]="@> o  @     @   @",M[3]="@  @     @      @",M[4]="@  @  @  @  @   @",M[5]="@@@@@@@@@@@@@@@@@",A[0]=new t(M),M=new Array,M[0]="@@@@@@@@@@@@@@@@@",M[1]="@@@@@@@@@     <@@",M[2]="@@@@@@@@@ o@  @@@",M[3]="@@@@@@@@@     @@@",M[4]="@@@@@@@@@   @ @@@",M[5]="@x     @@   o   @",M[6]="@@              @",M[7]="@x     @@@@@@@@@@",M[8]="@@@@@@@@@@@@@@@@@",A[1]=new t(M),M=new Array,M[0]="@@@@@@@@@@@@@@@@@",M[1]="@@@@@@   @@@@@@@@",M[2]="@@@@@@ @>o @@@@@@",M[3]="@@@@@@x  @ @@@@@@",M[4]="@@@@@@ ox  @@@@@@",M[5]="@@@@@@@  @@@@@@@@",M[6]="@@@@@@@  @@@@@@@@",M[7]="@@@@@@@@@@@@@@@@@",A[2]=new t(M),parts.push(new Part("ogre")),parts[parts.length-1].video=!0;var S,P,X={Up:0,Left:1,Right:2,Down:3},Y={None:-1,Empty:0,Wall:1,Crate:2,Slot:3,Start:4};S=document.getElementById("myDrawing"),P=S.getContext("2d");var E={imgArray:[],toLoad:0,tileArray:[],callback:0,init:function(t,e){this.imgArray=t,this.toLoad=this.imgArray.length,this.callback=e;for(i in this.imgArray)this.tileArray[i]=0},startLoading:function(){for(i in this.imgArray)img=new Image,img.src=this.imgArray[i],img.imgIndex=i,img.onload=function(){E.finishedLoading(this)}},finishedLoading:function(t){this.toLoad-=1,this.tileArray[t.imgIndex]=new s(t),this.toLoad<=0&&this.callback(this.tileArray)}};E.init(new Array("./parts/sokoban/assets/img/textures/ground.png","./parts/sokoban/assets/img/textures/wall.png","./parts/sokoban/assets/img/textures/stone2.png"),c),E.startLoading();var C;playerDirOffset=new Array(3,1,2,0),playerAniOffset=new Array(0,1,2,3);var O,I,L=new Array,W=new Array,R=0,U=0,_=0,H=32,N=32,T=new Array,B=500,z=new e;document.onkeydown=function(t){var e=t;switch(e.keyCode){case 38:z.moveUp();break;case 37:z.moveLeft();break;case 39:z.moveRight();break;case 40:z.moveDown();break;case 78:g();break;case 0:114===e.charCode?y():117===e.charCode&&n()}v(),p()},$(function(){$("#arrow_top").on("click",function(){var t=$.Event("keydown",{keyCode:38});$("body").trigger(t),console.log("fdfddfdkg")}),$("#arrow_bottom").on("click",function(){var t=$.Event("keydown",{keyCode:40});$("body").trigger(t)}),$("#arrow_left").on("click",function(){var t=$.Event("keydown",{keyCode:37});$("body").trigger(t)}),$("#arrow_right").on("click",function(){var t=$.Event("keydown",{keyCode:39});$("body").trigger(t)}),$("#btn_game_reload").on("click",function(){y()}),$("#btn_game_cancel").on("click",function(){n()}),$.fn.nodoubletapzoom=function(){$(this).bind("touchstart",function(t){var e=t.timeStamp,i=$(this).data("lastTouch")||e,a=e-i,r=t.originalEvent.touches.length;$(this).data("lastTouch",e),!a||a>500||r>1||(t.preventDefault(),$(t.target).trigger("click"))})},$("body").nodoubletapzoom(),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&$("head").append('<link rel="stylesheet" href="./parts/sokoban/mqmobile.css" />')}),window.appendNext("stomachjump")};