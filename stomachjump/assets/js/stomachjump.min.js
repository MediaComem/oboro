function Platform(){this.width=70,this.height=17,this.x=Math.random()*(width-this.width),this.y=position,position+=height/platformCount,this.flag=0,this.state=0,this.cx=0,this.cy=0,this.cwidth=105,this.cheight=31,this.draw=function(){try{1==this.type?this.cy=0:2==this.type?this.cy=61:3==this.type&&0===this.flag?this.cy=31:3==this.type&&1==this.flag?this.cy=1e3:4==this.type&&0===this.state?this.cy=90:4==this.type&&1==this.state&&(this.cy=1e3),ctx.drawImage(image,this.cx,this.cy,this.cwidth,this.cheight,this.x,this.y,this.width,this.height)}catch(t){}},score>=5e3?this.types=[2,3,3,3,4,4,4,4]:score>=2e3&&5e3>score?this.types=[2,2,2,3,3,3,3,4,4,4,4]:score>=1e3&&2e3>score?this.types=[2,2,2,3,3,3,3,3]:score>=500&&1e3>score?this.types=[1,1,1,1,1,2,2,2,2,3,3,3,3]:score>=100&&500>score?this.types=[1,1,1,1,2,2]:this.types=[1],this.type=this.types[Math.floor(Math.random()*this.types.length)],3==this.type&&1>broken?broken++:3==this.type&&broken>=1&&(this.type=1,broken=0),this.moved=0,this.vx=1}function init(){function t(){ctx.clearRect(0,0,width,height)}function e(){"left"==n?(player.dir="left",player.vy<-7&&player.vy>-15&&(player.dir="left_land")):"right"==n&&(player.dir="right",player.vy<-7&&player.vy>-15&&(player.dir="right_land")),document.onkeydown=function(t){var e=t.keyCode;37==e?(n="left",player.isMovingLeft=!0):39==e&&(n="right",player.isMovingRight=!0),32==e&&(firstRun===!0?init():reset())},document.onkeyup=function(t){var e=t.keyCode;37==e?(n="left",player.isMovingLeft=!1):39==e&&(n="right",player.isMovingRight=!1)},player.isMovingLeft===!0?(player.x+=player.vx,player.vx-=.07):(player.x+=player.vx,player.vx<0&&(player.vx+=.07)),player.isMovingRight===!0?(player.x+=player.vx,player.vx+=.07):(player.x+=player.vx,player.vx>0&&(player.vx-=.07)),player.vx>8?player.vx=8:player.vx<-8&&(player.vx=-8),player.y+player.height>base.y&&base.y<height&&player.jump(),base.y>height&&player.y+player.height>height&&"lol"!=player.isDead&&(player.isDead=!0),player.x>width?player.x=0-player.width:player.x<0-player.width&&(player.x=width),player.y>=height/2-player.height/2?(player.y+=player.vy,player.vy+=gravity):(platforms.forEach(function(t,e){player.vy<0&&(t.y-=player.vy),t.y>height&&(platforms[e]=new Platform,platforms[e].y=t.y-height)}),base.y-=player.vy,player.vy+=gravity,player.vy>=0&&(player.y+=player.vy,player.vy+=gravity),score++),a(),player.isDead===!0&&s()}function i(){var t=Spring,e=platforms[0];1==e.type||2==e.type?(t.x=e.x+e.width/2-t.width/2,t.y=e.y-e.height-10,t.y>height/1.1&&(t.state=0),t.draw()):(t.x=0-t.width,t.y=0-t.height)}function r(){var t=platform_broken_substitute;platforms.forEach(function(e,i){2==e.type&&((e.x<0||e.x+e.width>width)&&(e.vx*=-1),e.x+=e.vx),1==e.flag&&t.appearance===!1&&0===l&&(t.x=e.x,t.y=e.y,t.appearance=!0,l++),e.draw()}),t.appearance===!0&&(t.draw(),t.y+=8),t.y>height&&(t.appearance=!1)}function a(){platforms.forEach(function(t,e){if(player.vy>0&&0===t.state&&player.x+15<t.x+t.width&&player.x+player.width-15>t.x&&player.y+player.height>t.y&&player.y+player.height<t.y+t.height){if(3==t.type&&0===t.flag)return t.flag=1,void(l=0);if(4==t.type&&0===t.state)player.jump(),t.state=1;else{if(1==t.flag)return;player.jump()}}});var t=Spring;player.vy>0&&0===t.state&&player.x+15<t.x+t.width&&player.x+player.width-15>t.x&&player.y+player.height>t.y&&player.y+player.height<t.y+t.height&&(t.state=1,player.jumpHigh())}function h(){var t=document.getElementById("score");t.innerHTML=score}function s(){if(platforms.forEach(function(t,e){t.y-=12}),player.y>height/2&&0===flag)player.y-=8,player.vy=0;else if(player.y<height/2)flag=1;else if(player.y+player.height>height){showGoMenu(),hideScore(),player.isDead="lol";var t=document.getElementById("tweetBtn");t.href="http://twitter.com/share?url=http://is.gd/2LVtL1&text=Je viens de faire "+score+" points sur le jeu Doodle Jump en HTML5!&via=Forums_Mediabox&related=julienchauveau";var e=document.getElementById("fbBtn");e.href="http://facebook.com/sharer.php?s=100&p[url]=http://julienchauveau.com/labs/doodlejump/&p[title]=Je viens de faire "+score+" points sur le jeu Doodle Jump !&p[summary]=Pouvez-vous me battre dans cette version incroyable de Doodle Jump créé en HTML5 ?"}}function y(){t(),r(),i(),e(),player.draw(),base.draw(),h(),n="",player.isMovingLeft=!1,player.isMovingRight=!1}var n="left",l=0;firstRun=!1,menuLoop=function(){},animloop=function(){y(),requestAnimFrame(animloop)},animloop(),hideMenu(),showScore()}function reset(){hideGoMenu(),showScore(),player.isDead=!1,flag=0,position=0,score=0,base=new Base,player=new Player,Spring=new spring,platform_broken_substitute=new Platform_broken_substitute,platforms=[];for(var t=0;platformCount>t;t++)platforms.push(new Platform)}function hideMenu(){var t=document.getElementById("mainMenu");t.style.zIndex=-1}function showGoMenu(){var t=document.getElementById("gameOverMenu");t.style.zIndex=1,t.style.visibility="visible";var e=document.getElementById("go_score");e.innerHTML="Vous avez obtenu "+score+" points !"}function hideGoMenu(){var t=document.getElementById("gameOverMenu");t.style.zIndex=-1,t.style.visibility="hidden"}function showScore(){var t=document.getElementById("scoreBoard");t.style.zIndex=1}function hideScore(){var t=document.getElementById("scoreBoard");t.style.zIndex=-1}function playerJump(){player.y+=player.vy,player.vy+=gravity,player.vy>0&&player.x+15<260&&player.x+player.width-15>155&&player.y+player.height>475&&player.y+player.height<500&&player.jump(),"left"==dir?(player.dir="left",player.vy<-7&&player.vy>-15&&(player.dir="left_land")):"right"==dir&&(player.dir="right",player.vy<-7&&player.vy>-15&&(player.dir="right_land")),document.onkeydown=function(t){var e=t.keyCode;37==e?(dir="left",player.isMovingLeft=!0):39==e&&(dir="right",player.isMovingRight=!0),32==e&&(firstRun===!0?(init(),firstRun=!1):reset())},document.onkeyup=function(t){var e=t.keyCode;37==e?(dir="left",player.isMovingLeft=!1):39==e&&(dir="right",player.isMovingRight=!1)},player.isMovingLeft===!0?(player.x+=player.vx,player.vx-=.1):(player.x+=player.vx,player.vx<0&&(player.vx+=.1)),player.isMovingRight===!0?(player.x+=player.vx,player.vx+=.1):(player.x+=player.vx,player.vx>0&&(player.vx-=.1)),player.y+player.height>base.y&&base.y<height&&player.jump(),player.x>width?player.x=0-player.width:player.x<0-player.width&&(player.x=width),player.draw()}function update(){ctx.clearRect(0,0,width,height),playerJump()}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}();var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),container=document.getElementById("container"),mc=new Hammer(container),img=new Image,width=422,height=552;canvas.width=width,canvas.height=height;var platforms=[],image=document.getElementById("sprite"),player,platformCount=10,position=0,gravity=.2,animloop,flag=0,menuloop,broken=0,dir,score=0,firstRun=!0,Base=function(){this.height=181,this.width=width,this.base=document.getElementById("base"),this.cx=0,this.cy=0,this.cwidth=440,this.cheight=181,this.moved=0,this.x=0,this.y=height-this.height,this.draw=function(){try{ctx.drawImage(this.base,this.cx,this.cy,this.cwidth,this.cheight,this.x,this.y,this.width,this.height)}catch(t){}}},base=new Base,Player=function(){this.vy=11,this.vx=0,this.isMovingLeft=!1,this.isMovingRight=!1,this.isDead=!1,this.width=55,this.height=40,this.cx=0,this.cy=0,this.cwidth=110,this.cheight=80,this.dir="left",this.x=width/2-this.width/2,this.y=height,this.draw=function(){try{"right"==this.dir?this.cy=121:"left"==this.dir?this.cy=201:"right_land"==this.dir?this.cy=289:"left_land"==this.dir&&(this.cy=371),ctx.drawImage(image,this.cx,this.cy,this.cwidth,this.cheight,this.x,this.y,this.width,this.height)}catch(t){}},this.jump=function(){this.vy=-8},this.jumpHigh=function(){this.vy=-16}};player=new Player;for(var i=0;platformCount>i;i++)platforms.push(new Platform);var Platform_broken_substitute=function(){this.height=30,this.width=70,this.x=0,this.y=0,this.cx=0,this.cy=554,this.cwidth=105,this.cheight=60,this.appearance=!1,this.draw=function(){try{if(this.appearance!==!0)return;ctx.drawImage(image,this.cx,this.cy,this.cwidth,this.cheight,this.x,this.y,this.width,this.height)}catch(t){}}},platform_broken_substitute=new Platform_broken_substitute,spring=function(){this.x=0,this.y=0,this.width=26,this.height=30,this.cx=0,this.cy=0,this.cwidth=45,this.cheight=53,this.state=0,this.draw=function(){try{0===this.state?this.cy=445:1==this.state&&(this.cy=501),ctx.drawImage(image,this.cx,this.cy,this.cwidth,this.cheight,this.x,this.y,this.width,this.height)}catch(t){}}},Spring=new spring;mc.on("panleft panright",function(t){"panleft"==t.type?(dir="left",player.isMovingLeft=!0):"panright"==t.type&&(dir="right",player.isMovingRight=!0),console.log(dir)}),menuLoop=function(){update(),requestAnimFrame(menuLoop)},menuLoop();